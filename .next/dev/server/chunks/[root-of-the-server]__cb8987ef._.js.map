{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kanna/my-interview-backend/app/api/ai-model/route.js"],"sourcesContent":["// app/api/ai-model/route.js\r\nimport { NextResponse } from \"next/server\";\r\nimport OpenAI from \"openai\";\r\n\r\n// üõ†Ô∏è NEW: OPTIONS handler for CORS preflight\r\nexport async function OPTIONS() {\r\n  return NextResponse.json(null, {\r\n    status: 200,\r\n    headers: {\r\n      'Access-Control-Allow-Origin': '*', \r\n      'Access-Control-Allow-Methods': 'POST, OPTIONS', \r\n      'Access-Control-Allow-Headers': 'Content-Type', \r\n    },\r\n  });\r\n}\r\n\r\nexport const QUESTION_PROMPT = `You are an expert technical interviewer.\r\nBased on the following inputs, generate a well-structured list of high-quality interview questions\r\n\r\nJob Title: {{jobTitle}}\r\nJob Description: {{jobDescription}}\r\nInterview Duration: {{duration}}\r\nInterview Type: {{type}}\r\n\r\nüìù Your task:\r\nAnalyze the job description to identify key responsibilities, required skills, and expected experience\r\nGenerate a list of interview questions depends on interview duration\r\nAdjust the number and depth of questions to match the interview duration.\r\nEnsure the questions match the tone and structure of a real-life {{type}} interview.\r\nüåø Format your response in JSON format with array list of questions\r\nformat: interviewQuestions=[\r\n  {\r\n    question:\"\",\r\n    type:\"Technical\" | \"Behavioral\" | \"Experience\" | \"Problem Solving\" | \"Leadership\" | \"Coding\" \r\n  },\r\n  ...\r\n]\r\n\r\nüî¥ The goal is to create a structured, relevant, and time-optimized interview plan for a {{jobTitle}} role.`;\r\n\r\nexport async function POST(req) {\r\n  // Define default CORS headers for all responses (success or error)\r\n  const corsHeaders = {\r\n    'Access-Control-Allow-Origin': '*',\r\n    'Access-Control-Allow-Methods': 'POST, OPTIONS',\r\n    'Access-Control-Allow-Headers': 'Content-Type',\r\n  };\r\n\r\n  try {\r\n    const { jobPosition, jobDescription, duration, type } = await req.json();\r\n\r\n    const FINAL_PROMPT = QUESTION_PROMPT\r\n      .replace('{{jobTitle}}', jobPosition)\r\n      .replace('{{jobDescription}}', jobDescription)\r\n      .replace('{{duration}}', duration)\r\n      .replace('{{type}}', type);\r\n\r\n    const openai = new OpenAI({\r\n      baseURL: \"https://openrouter.ai/api/v1\",\r\n      apiKey: process.env.OPENROUTER_API_KEY, \r\n    });\r\n\r\n    const completion = await openai.chat.completions.create({\r\n      model: 'mistralai/mistral-small-3.2-24b-instruct',\r\n      messages: [\r\n        {\r\n          role: 'user',\r\n          content: FINAL_PROMPT,\r\n        },\r\n      ],\r\n    });\r\n\r\n    const messageContent = completion.choices?.[0]?.message?.content || '';\r\n\r\n    if (!messageContent) {\r\n      throw new Error(\"AI response is empty\");\r\n    }\r\n\r\n    // Attempt to extract the JSON array\r\n    const jsonMatch = messageContent.match(/\\{[\\s\\S]*\\}/);\r\n    if (!jsonMatch) {\r\n      console.error(\"No JSON object found in AI response:\\n\", messageContent);\r\n      throw new Error(\"Failed to extract JSON from AI response\");\r\n    }\r\n\r\n    const jsonString = jsonMatch[0].trim();\r\n    let parsed;\r\n    try {\r\n      parsed = JSON.parse(jsonString);\r\n    } catch (jsonError) {\r\n      console.error(\"JSON parsing failed. Raw JSON content:\\n\", jsonString);\r\n      throw new Error(\"Failed to parse JSON from AI response\");\r\n    }\r\n\r\n    if (!parsed?.interviewQuestions) {\r\n      throw new Error(\"AI response does not contain 'interviewQuestions'\");\r\n    }\r\n\r\n    // 1. SUCCESS RESPONSE: Include CORS headers\r\n    return NextResponse.json(parsed.interviewQuestions, {\r\n      status: 200,\r\n      headers: corsHeaders,\r\n    });\r\n  } catch (e) {\r\n    console.error(\"Server error:\", e);\r\n    \r\n    // 2. ERROR RESPONSE: Include CORS headers\r\n    return NextResponse.json(\r\n      { error: \"Server error\", details: e.message || String(e) },\r\n      { \r\n        status: 500,\r\n        headers: corsHeaders,\r\n      }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":"AAAA,4BAA4B;;;;;;;;;AAC5B;AACA;AAAA;;;AAGO,eAAe;IACpB,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM;QAC7B,QAAQ;QACR,SAAS;YACP,+BAA+B;YAC/B,gCAAgC;YAChC,gCAAgC;QAClC;IACF;AACF;AAEO,MAAM,kBAAkB,CAAC;;;;;;;;;;;;;;;;;;;;;;2GAsB2E,CAAC;AAErG,eAAe,KAAK,GAAG;IAC5B,mEAAmE;IACnE,MAAM,cAAc;QAClB,+BAA+B;QAC/B,gCAAgC;QAChC,gCAAgC;IAClC;IAEA,IAAI;QACF,MAAM,EAAE,WAAW,EAAE,cAAc,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,IAAI;QAEtE,MAAM,eAAe,gBAClB,OAAO,CAAC,gBAAgB,aACxB,OAAO,CAAC,sBAAsB,gBAC9B,OAAO,CAAC,gBAAgB,UACxB,OAAO,CAAC,YAAY;QAEvB,MAAM,SAAS,IAAI,mLAAM,CAAC;YACxB,SAAS;YACT,QAAQ,QAAQ,GAAG,CAAC,kBAAkB;QACxC;QAEA,MAAM,aAAa,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACtD,OAAO;YACP,UAAU;gBACR;oBACE,MAAM;oBACN,SAAS;gBACX;aACD;QACH;QAEA,MAAM,iBAAiB,WAAW,OAAO,EAAE,CAAC,EAAE,EAAE,SAAS,WAAW;QAEpE,IAAI,CAAC,gBAAgB;YACnB,MAAM,IAAI,MAAM;QAClB;QAEA,oCAAoC;QACpC,MAAM,YAAY,eAAe,KAAK,CAAC;QACvC,IAAI,CAAC,WAAW;YACd,QAAQ,KAAK,CAAC,0CAA0C;YACxD,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,aAAa,SAAS,CAAC,EAAE,CAAC,IAAI;QACpC,IAAI;QACJ,IAAI;YACF,SAAS,KAAK,KAAK,CAAC;QACtB,EAAE,OAAO,WAAW;YAClB,QAAQ,KAAK,CAAC,4CAA4C;YAC1D,MAAM,IAAI,MAAM;QAClB;QAEA,IAAI,CAAC,QAAQ,oBAAoB;YAC/B,MAAM,IAAI,MAAM;QAClB;QAEA,4CAA4C;QAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC,OAAO,kBAAkB,EAAE;YAClD,QAAQ;YACR,SAAS;QACX;IACF,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,iBAAiB;QAE/B,0CAA0C;QAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAgB,SAAS,EAAE,OAAO,IAAI,OAAO;QAAG,GACzD;YACE,QAAQ;YACR,SAAS;QACX;IAEJ;AACF","debugId":null}}]
}